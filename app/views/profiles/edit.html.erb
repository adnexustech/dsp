<% content_for :breadcrumb do %>
  <div class="page-title-left">
    <ol class="breadcrumb page-breadcrumb">
      <li><i class="fa fa-home"></i><a href="/">Home</a></li>
      <li><i class="fa fa-angle-right"></i></li>
      <li><a href="<%= profile_path %>">My Profile</a></li>
      <li><i class="fa fa-angle-right"></i></li>
      <li class="active">Edit Profile</li>
    </ol>
    <div class="page-header">
      <div class="page-title">Edit Professional Profile</div>
    </div>
  </div>
<%end%>

<% content_for :main_body do %>
<div class="max-w-4xl mx-auto">
  <%= form_with model: @user, url: profile_path, method: :patch, local: true, html: { multipart: true, class: "space-y-6" } do |f| %>
    
    <!-- Avatar Section -->
    <div class="bg-zinc-900 border border-zinc-800 rounded-xl p-6">
      <h2 class="text-xl font-semibold mb-4 flex items-center gap-3">
        <i class="fa-solid fa-image text-blue-500"></i>
        Profile Photo
      </h2>
      
      <div class="flex items-start gap-6">
        <!-- Avatar Preview -->
        <div id="avatarPreview" style="width: 120px; height: 120px; border-radius: 12px; overflow: hidden; border: 2px solid #27272a; background: linear-gradient(135deg, #3b82f6, #8b5cf6); display: flex; align-items: center; justify-content: center;">
          <% if @user.avatar.attached? %>
            <%= image_tag @user.avatar, style: "width: 100%; height: 100%; object-fit: cover;" %>
          <% else %>
            <span style="font-size: 36px; font-weight: 600; color: white;"><%= @user.initials %></span>
          <% end %>
        </div>

        <!-- Upload Controls -->
        <div class="flex-1">
          <div class="mb-3">
            <label class="block text-sm font-medium text-zinc-400 mb-2">Upload New Photo</label>
            <%= f.file_field :avatar, accept: "image/*", class: "hidden", id: "avatarInput", onchange: "previewAvatar(event)" %>
            <label for="avatarInput" class="inline-flex items-center gap-2 px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 cursor-pointer transition-colors">
              <i class="fa-solid fa-upload"></i>
              Choose File
            </label>
          </div>
          <p class="text-sm text-zinc-500">Recommended: Square image, at least 400x400px. Max 5MB.</p>
          <p class="text-sm text-zinc-500 mt-1">Supports: JPG, PNG, GIF</p>
        </div>
      </div>
    </div>

    <!-- Basic Information -->
    <div class="bg-zinc-900 border border-zinc-800 rounded-xl p-6">
      <h2 class="text-xl font-semibold mb-4 flex items-center gap-3">
        <i class="fa-solid fa-user text-green-500"></i>
        Basic Information
      </h2>

      <div class="space-y-4">
        <div>
          <label class="block text-sm font-medium text-zinc-400 mb-2">
            Full Name <span class="text-red-500">*</span>
          </label>
          <%= f.text_field :name, class: "w-full px-4 py-2 bg-zinc-800 border border-zinc-700 rounded-lg text-white focus:border-blue-500 focus:outline-none", placeholder: "Your full name", required: true %>
        </div>

        <div>
          <label class="block text-sm font-medium text-zinc-400 mb-2">
            Email Address <span class="text-red-500">*</span>
          </label>
          <%= f.email_field :email, class: "w-full px-4 py-2 bg-zinc-800 border border-zinc-700 rounded-lg text-white focus:border-blue-500 focus:outline-none", placeholder: "your.email@example.com", required: true %>
        </div>

        <div>
          <label class="block text-sm font-medium text-zinc-400 mb-2">
            Professional Bio
          </label>
          <%= f.text_area :bio, rows: 6, class: "w-full px-4 py-2 bg-zinc-800 border border-zinc-700 rounded-lg text-white focus:border-blue-500 focus:outline-none resize-y", placeholder: "Tell potential clients about your experience, expertise, and what makes you unique..." %>
          <p class="text-sm text-zinc-500 mt-1">A compelling bio helps clients understand your value</p>
        </div>
      </div>
    </div>

    <!-- Skills & Expertise -->
    <div class="bg-zinc-900 border border-zinc-800 rounded-xl p-6">
      <h2 class="text-xl font-semibold mb-4 flex items-center gap-3">
        <i class="fa-solid fa-lightbulb text-yellow-500"></i>
        Skills & Expertise
      </h2>

      <div class="space-y-4">
        <div>
          <label class="block text-sm font-medium text-zinc-400 mb-2">
            Your Skills
          </label>
          <%= f.text_field :skills, class: "w-full px-4 py-2 bg-zinc-800 border border-zinc-700 rounded-lg text-white focus:border-blue-500 focus:outline-none", placeholder: "e.g., Campaign Management, Video Editing, Analytics" %>
          <p class="text-sm text-zinc-500 mt-1">Separate skills with commas. These appear as badges on your profile.</p>
        </div>

        <div>
          <label class="block text-sm font-medium text-zinc-400 mb-2">
            Service Categories
          </label>
          <%= f.text_field :service_categories, class: "w-full px-4 py-2 bg-zinc-800 border border-zinc-700 rounded-lg text-white focus:border-blue-500 focus:outline-none", placeholder: "e.g., Campaign Management, Video Production" %>
          <p class="text-sm text-zinc-500 mt-1">Categories help clients find you in the marketplace. Separate with commas.</p>
          <div class="mt-2 flex flex-wrap gap-2">
            <span class="text-xs text-zinc-500">Suggestions:</span>
            <% ['Campaign Management', 'Video Production', 'Banner Design', 'Copywriting', 'Analytics & Reporting', 'Social Media Marketing'].each do |category| %>
              <button type="button" onclick="addCategory('<%= category %>')" class="px-2 py-1 text-xs bg-zinc-800 hover:bg-zinc-700 border border-zinc-700 rounded text-zinc-400 hover:text-white transition-colors">
                <%= category %>
              </button>
            <% end %>
          </div>
        </div>
      </div>
    </div>

    <!-- Service Information -->
    <div class="bg-zinc-900 border border-zinc-800 rounded-xl p-6">
      <h2 class="text-xl font-semibold mb-4 flex items-center gap-3">
        <i class="fa-solid fa-briefcase text-purple-500"></i>
        Service Information
      </h2>

      <div class="space-y-4">
        <div>
          <label class="block text-sm font-medium text-zinc-400 mb-2">
            Hourly Rate (USD)
          </label>
          <div class="relative">
            <span class="absolute left-4 top-1/2 -translate-y-1/2 text-zinc-500">$</span>
            <%= f.number_field :hourly_rate, step: 0.01, min: 0, class: "w-full pl-8 pr-4 py-2 bg-zinc-800 border border-zinc-700 rounded-lg text-white focus:border-blue-500 focus:outline-none", placeholder: "0.00" %>
          </div>
          <p class="text-sm text-zinc-500 mt-1">Your hourly rate for services. Leave blank if not offering hourly services.</p>
        </div>

        <div class="flex items-center gap-3 p-4 bg-zinc-800 border border-zinc-700 rounded-lg">
          <%= f.check_box :available_for_hire, class: "w-5 h-5 rounded border-zinc-600 text-blue-600 focus:ring-blue-500 focus:ring-offset-zinc-900" %>
          <div class="flex-1">
            <label class="text-sm font-medium cursor-pointer">
              Available for Hire
            </label>
            <p class="text-xs text-zinc-500 mt-0.5">Check this to appear in the marketplace and accept new clients</p>
          </div>
        </div>
      </div>
    </div>

    <!-- Social Links -->
    <div class="bg-zinc-900 border border-zinc-800 rounded-xl p-6">
      <h2 class="text-xl font-semibold mb-4 flex items-center gap-3">
        <i class="fa-solid fa-link text-orange-500"></i>
        Social & Portfolio Links
      </h2>

      <div class="space-y-4">
        <div>
          <label class="block text-sm font-medium text-zinc-400 mb-2">
            <i class="fa-solid fa-briefcase text-purple-400"></i> Portfolio URL
          </label>
          <%= f.url_field :portfolio_url, class: "w-full px-4 py-2 bg-zinc-800 border border-zinc-700 rounded-lg text-white focus:border-blue-500 focus:outline-none", placeholder: "https://yourportfolio.com" %>
        </div>

        <div>
          <label class="block text-sm font-medium text-zinc-400 mb-2">
            <i class="fa-brands fa-twitter text-blue-400"></i> Twitter/X Profile
          </label>
          <%= f.url_field :twitter_url, class: "w-full px-4 py-2 bg-zinc-800 border border-zinc-700 rounded-lg text-white focus:border-blue-500 focus:outline-none", placeholder: "https://twitter.com/username" %>
        </div>

        <div>
          <label class="block text-sm font-medium text-zinc-400 mb-2">
            <i class="fa-brands fa-linkedin text-blue-500"></i> LinkedIn Profile
          </label>
          <%= f.url_field :linkedin_url, class: "w-full px-4 py-2 bg-zinc-800 border border-zinc-700 rounded-lg text-white focus:border-blue-500 focus:outline-none", placeholder: "https://linkedin.com/in/username" %>
        </div>
      </div>
    </div>

    <!-- Form Actions -->
    <div class="flex gap-3 sticky bottom-0 bg-zinc-950 border-t border-zinc-800 p-4 -mx-6 -mb-6 rounded-b-xl">
      <%= f.submit "Save Changes", class: "flex-1 px-6 py-3 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors font-semibold" %>
      <%= link_to "Cancel", profile_path, class: "flex-1 px-6 py-3 bg-zinc-800 text-white rounded-lg hover:bg-zinc-700 transition-colors font-semibold text-center" %>
    </div>

  <% end %>
</div>

<script>
  // Avatar Preview
  function previewAvatar(event) {
    const file = event.target.files[0];
    if (file) {
      const reader = new FileReader();
      reader.onload = function(e) {
        const preview = document.getElementById('avatarPreview');
        preview.innerHTML = '<img src="' + e.target.result + '" style="width: 100%; height: 100%; object-fit: cover;">';
      };
      reader.readAsDataURL(file);
    }
  }

  // Add Category Helper
  function addCategory(category) {
    const input = document.querySelector('input[name="user[service_categories]"]');
    const currentValue = input.value.trim();
    
    // Check if category already exists
    const categories = currentValue.split(',').map(c => c.trim());
    if (categories.includes(category)) {
      return; // Already added
    }
    
    // Add category
    if (currentValue === '') {
      input.value = category;
    } else {
      input.value = currentValue + ', ' + category;
    }
    
    // Visual feedback
    event.target.classList.add('bg-blue-600', 'text-white');
    setTimeout(() => {
      event.target.classList.remove('bg-blue-600', 'text-white');
    }, 300);
  }

  // Form Validation
  document.querySelector('form').addEventListener('submit', function(e) {
    const name = document.querySelector('input[name="user[name]"]').value.trim();
    const email = document.querySelector('input[name="user[email]"]').value.trim();
    
    if (!name || !email) {
      e.preventDefault();
      alert('Please fill in all required fields (Name and Email)');
      return false;
    }
    
    return true;
  });
</script>
<%end%>

<!DOCTYPE html>
<html lang="en" class="h-full">
<head>
    <title>Adnexus</title>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <%= favicon_link_tag 'favicon.png' %>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">

    <%= stylesheet_link_tag "tailwind", "data-turbo-track": "reload" %>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css" integrity="sha512-DTOQO9RWCH3ppGqcWaEA1BIZOC6xxalwEsw9c2QQeAIftl+Vegovlnee1c9QX4TctnWMn13TZye+giMm8e2LwA==" crossorigin="anonymous" referrerpolicy="no-referrer" />

    <style>
      /* Override legacy CSS with pure black shadcn-style theme */
      *:not(i):not(.fa):not(.fa-solid):not(.fa-regular):not(.fa-brands), 
      *:not(i):not(.fa):not(.fa-solid):not(.fa-regular):not(.fa-brands)::before, 
      *:not(i):not(.fa):not(.fa-solid):not(.fa-regular):not(.fa-brands)::after {
        font-family: 'Inter', -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif !important;
      }
      
      /* Ensure FontAwesome icons use correct font */
      i.fa-solid, i.fa-regular, i.fa-brands,
      .fa-solid, .fa-regular, .fa-brands {
        font-family: 'Font Awesome 6 Free', 'Font Awesome 6 Brands' !important;
        font-style: normal !important;
      }
      
      html, body {
        background-color: #000000 !important;
        color: #ffffff !important;
      }
      
      /* Add padding for fixed header */
      body {
        padding-top: 64px !important;
      }

      #wrapper, #page-wrapper, .page-content {
        background-color: #000000 !important;
      }
      
      /* Hide back-to-top button */
      #totop {
        display: none !important;
      }

      /* Header & Topbar - Pure Black, Fixed at Top */
      .page-header-topbar {
        position: fixed !important;
        top: 0 !important;
        left: 0 !important;
        right: 0 !important;
        z-index: 1000 !important;
        background-color: #000000 !important;
      }

      #topbar {
        background-color: #000000 !important;
        border-bottom: 1px solid #1a1a1a !important;
        height: 64px !important;
        padding: 0 16px !important;
        display: flex !important;
        align-items: center !important;
        margin: 0 !important;
        position: relative !important;
      }

      .navbar-header {
        display: flex !important;
        align-items: center !important;
        gap: 16px !important;
        flex: 0 0 auto !important;
      }
      
      /* Center search bar in the middle of header */
      .header-search {
        position: absolute !important;
        left: 50% !important;
        transform: translateX(-50%) !important;
        max-width: 500px !important;
        width: calc(100% - 480px) !important; /* Account for space needed by left and right items */
        margin: 0 !important;
      }
      
      @media (max-width: 1280px) {
        .header-search {
          max-width: 400px !important;
          width: calc(100% - 420px) !important;
        }
      }

      .topbar-main {
        display: flex !important;
        align-items: center !important;
        gap: 16px !important;
        margin-left: auto !important;
        flex: 0 0 auto !important;
      }

      .navbar-top-links {
        margin: 0 !important;
        padding: 0 !important;
        display: flex !important;
        align-items: center !important;
      }
      
      /* Logo - White on Black Header */
      #logo {
        display: flex !important;
        align-items: center !important;
        padding: 0 !important;
        margin: 0 !important;
        text-decoration: none !important;
        background: transparent !important;
      }

      #logo:hover {
        opacity: 0.8 !important;
      }

      .logo-image {
        height: 38px !important;
        width: auto !important;
        object-fit: contain !important;
        filter: brightness(0) invert(1) !important;  /* Make logo white */
      }
      
      /* Sidebar - Icon-only like Google/Airbnb with pin functionality */
      #sidebar {
        background-color: #000000 !important;
        border-right: 1px solid #1a1a1a !important;
        width: 72px !important;
        position: fixed !important;
        top: 64px !important;
        left: 0 !important;
        height: calc(100vh - 64px) !important;
        overflow-y: auto !important;
        overflow-x: hidden !important;
        transition: width 0.2s ease !important;
        z-index: 100 !important;
      }

      #sidebar:hover:not(.sidebar-pinned) {
        width: 240px !important;
      }

      /* Pinned sidebar stays open */
      #sidebar.sidebar-pinned {
        width: 240px !important;
      }

      /* Sidebar pin button */
      .sidebar-pin {
        position: absolute !important;
        top: 12px !important;
        right: 12px !important;
        background: transparent !important;
        border: 1px solid #1a1a1a !important;
        color: #71717a !important;
        padding: 6px 8px !important;
        border-radius: 6px !important;
        cursor: pointer !important;
        transition: all 0.2s ease !important;
        opacity: 0 !important;
        font-size: 14px !important;
        z-index: 1000 !important;
      }

      #sidebar:hover .sidebar-pin,
      #sidebar.sidebar-pinned .sidebar-pin {
        opacity: 1 !important;
      }

      #sidebar.sidebar-pinned .sidebar-pin {
        color: #ffffff !important;
        background: #1a1a1a !important;
        border-color: #3f3f46 !important;
      }

      .sidebar-pin:hover {
        background-color: #1a1a1a !important;
        border-color: #3f3f46 !important;
        color: #ffffff !important;
      }
      
      /* Mobile sidebar hidden by default */
      @media (max-width: 768px) {
        #sidebar {
          transform: translateX(-100%) !important;
          z-index: 1000 !important;
        }
        
        body.sidebar-open #sidebar {
          transform: translateX(0) !important;
        }
        
        #page-wrapper {
          margin-left: 0 !important;
        }
      }
      
      /* Desktop sidebar always visible */
      @media (min-width: 769px) {
        #sidebar {
          transform: translateX(0) !important;
        }
        
        #page-wrapper {
          margin-left: 240px !important;
        }
      }
      
      /* Sidebar Menu Items */
      #sidebar #side-menu {
        padding: 16px 0 !important;
      }
      
      #sidebar #side-menu > li {
        margin: 2px 8px !important;
      }
      
      #sidebar #side-menu > li > a {
        display: flex !important;
        align-items: center !important;
        justify-content: flex-start !important;
        padding: 12px 14px !important;
        border-radius: 8px !important;
        color: #ffffff !important;
        text-decoration: none !important;
        transition: all 0.2s ease !important;
        background: transparent !important;
        position: relative !important;
        border: none !important;
      }
      
      #sidebar #side-menu > li > a:hover {
        background-color: #1a1a1a !important;
        color: #ffffff !important;
      }
      
      #sidebar #side-menu > li.active > a,
      #sidebar #side-menu > li > a.active {
        background-color: #1a1a1a !important;
        color: #ffffff !important;
      }
      
      #sidebar #side-menu .menu-title {
        display: inline-block !important;
        opacity: 0 !important;
        width: 0 !important;
        font-size: 15px !important;
        font-weight: 500 !important;
        margin-left: 0 !important;
        overflow: hidden !important;
        white-space: nowrap !important;
        transition: all 0.2s ease !important;
      }

      #sidebar:hover #side-menu .menu-title {
        opacity: 1 !important;
        width: auto !important;
        margin-left: 14px !important;
      }
      
      #sidebar #side-menu i.fa {
        width: 22px !important;
        min-width: 22px !important;
        font-size: 20px !important;
        color: #ffffff !important;
        text-align: center !important;
        transition: all 0.2s ease !important;
      }
      
      #sidebar #side-menu > li > a:hover i.fa,
      #sidebar #side-menu > li.active > a i.fa {
        color: #ffffff !important;
      }
      
      /* Hide icon backgrounds */
      .icon-bg {
        display: none !important;
      }
      
      /* Mobile menu toggle */
      .sidebar-toggle {
        background: transparent !important;
        border: 1px solid #1a1a1a !important;
        color: #ffffff !important;
        padding: 8px 12px !important;
        border-radius: 8px !important;
        cursor: pointer !important;
        transition: all 0.2s ease !important;
      }
      
      .sidebar-toggle:hover {
        background-color: #1a1a1a !important;
        border-color: #333333 !important;
      }
      
      .sidebar-toggle i {
        font-size: 18px !important;
      }
      
      /* Hide desktop toggle on mobile */
      @media (max-width: 768px) {
        .sidebar-toggle.hidden-xs {
          display: none !important;
        }
      }
      
      /* Show mobile toggle only on mobile */
      @media (min-width: 769px) {
        .navbar-header .sidebar-toggle {
          display: none !important;
        }
      }
      
      /* User menu trigger */
      .user-menu-trigger {
        display: flex !important;
        align-items: center !important;
        gap: 12px !important;
        padding: 6px 12px !important;
        background: transparent !important;
        border: 1px solid #1a1a1a !important;
        border-radius: 10px !important;
        transition: all 0.2s ease !important;
        text-decoration: none !important;
        color: #ffffff !important;
      }
      
      .user-menu-trigger:hover {
        background-color: #1a1a1a !important;
        border-color: #333333 !important;
      }
      
      .user-avatar {
        width: 32px !important;
        height: 32px !important;
        background: linear-gradient(135deg, #3b82f6, #8b5cf6) !important;
        border-radius: 8px !important;
        display: flex !important;
        align-items: center !important;
        justify-content: center !important;
        font-weight: 600 !important;
        font-size: 12px !important;
        color: #ffffff !important;
        letter-spacing: 0.5px !important;
      }
      
      .user-info {
        display: flex !important;
        flex-direction: column !important;
        align-items: flex-start !important;
        gap: 2px !important;
      }
      
      .user-name {
        font-size: 14px !important;
        font-weight: 500 !important;
        color: #ffffff !important;
        line-height: 1 !important;
      }
      
      .user-org {
        font-size: 12px !important;
        color: #ffffff !important;
        line-height: 1 !important;
      }
      
      .user-menu-trigger .fa-chevron-down {
        font-size: 12px !important;
        color: #ffffff !important;
        transition: transform 0.2s ease !important;
      }
      
      .user-menu-trigger:hover .fa-chevron-down {
        color: #ffffff !important;
      }
      
      @media (max-width: 640px) {
        .user-info {
          display: none !important;
        }
      }
      
      /* Responsive search bar adjustments */
      @media (max-width: 1024px) {
        .header-search {
          max-width: 300px !important;
          width: calc(100% - 360px) !important;
        }
        
        /* Hide "Search..." text on smaller screens */
        .header-search button > span:nth-child(2) {
          display: none !important;
        }
      }
      
      @media (max-width: 768px) {
        .header-search {
          max-width: 200px !important;
          width: calc(100% - 300px) !important;
        }
        
        /* Hide Cmd+K indicator on mobile */
        .header-search button > div:last-child {
          display: none !important;
        }
      }
      
      @media (max-width: 640px) {
        .header-search {
          display: none !important;
        }
      }
      
      /* Dropdown menu (user and org dropdowns) */
      .dropdown-menu,
      .org-dropdown-menu {
        background-color: #0a0a0a !important;
        border: 1px solid #1a1a1a !important;
        border-radius: 12px !important;
        padding: 8px !important;
        margin-top: 4px !important;
        min-width: 280px !important;
        box-shadow: 0 10px 40px rgba(0, 0, 0, 0.5) !important;
        transition: opacity 0.2s ease, transform 0.2s ease !important;
        opacity: 0;
      }
      
      .dropdown-menu[style*="display: block"],
      .org-dropdown-menu[style*="display: block"] {
        opacity: 1 !important;
      }

      /* Create invisible hover bridge between trigger and dropdown */
      .dropdown-menu::before {
        content: '' !important;
        position: absolute !important;
        top: -12px !important;
        left: 0 !important;
        right: 0 !important;
        height: 16px !important;
        background: transparent !important;
      }

      /* Keep dropdown visible on hover */
      .dropdown:hover > .dropdown-menu,
      .dropdown-menu:hover {
        display: block !important;
        opacity: 1 !important;
      }

      .dropdown {
        position: relative !important;
      }

      .dropdown .dropdown-menu {
        display: none !important;
        position: absolute !important;
        right: 0 !important;
        opacity: 0 !important;
      }

      .dropdown:hover .dropdown-menu {
        display: block !important;
        opacity: 1 !important;
        animation: fadeIn 0.15s ease forwards !important;
      }

      @keyframes fadeIn {
        from {
          opacity: 0;
          transform: translateY(-10px);
        }
        to {
          opacity: 1;
          transform: translateY(0);
        }
      }
      
      .dropdown-header {
        padding: 0 !important;
        background: transparent !important;
      }
      
      .user-header-info {
        display: flex !important;
        align-items: center !important;
        gap: 12px !important;
        padding: 12px !important;
        background: #0a0a0a !important;
        border-radius: 8px !important;
      }
      
      .user-header-avatar {
        width: 40px !important;
        height: 40px !important;
        background: linear-gradient(135deg, #3b82f6, #8b5cf6) !important;
        border-radius: 10px !important;
        display: flex !important;
        align-items: center !important;
        justify-content: center !important;
        font-weight: 700 !important;
        font-size: 16px !important;
        color: #ffffff !important;
        letter-spacing: 0.5px !important;
        flex-shrink: 0 !important;
      }
      
      .user-header-details {
        flex: 1 !important;
        min-width: 0 !important;
      }
      
      .user-header-name {
        font-size: 14px !important;
        font-weight: 600 !important;
        color: #ffffff !important;
        margin-bottom: 4px !important;
        white-space: nowrap !important;
        overflow: hidden !important;
        text-overflow: ellipsis !important;
      }
      
      .user-header-email {
        font-size: 12px !important;
        color: #ffffff !important;
        white-space: nowrap !important;
        overflow: hidden !important;
        text-overflow: ellipsis !important;
      }
      
      .dropdown-section-title {
        padding: 8px 12px 4px 12px !important;
        font-size: 11px !important;
        font-weight: 600 !important;
        color: #e0e0e0 !important;
        text-transform: uppercase !important;
        letter-spacing: 0.5px !important;
      }
      
      .dropdown-menu li a {
        display: flex !important;
        align-items: center !important;
        gap: 10px !important;
        color: #ffffff !important;
        padding: 10px 12px !important;
        border-radius: 8px !important;
        font-size: 14px !important;
        transition: all 0.2s ease !important;
        text-decoration: none !important;
      }
      
      .dropdown-menu li a i {
        width: 16px !important;
        font-size: 14px !important;
        color: #ffffff !important;
      }
      
      .dropdown-menu li a:hover {
        background-color: #1a1a1a !important;
        color: #ffffff !important;
      }
      
      .dropdown-menu li a:hover i {
        color: #ffffff !important;
      }
      
      .dropdown-menu .divider {
        background-color: #262626 !important;
        margin: 6px 0 !important;
        height: 1px !important;
      }
      
      /* Buttons - shadcn style with 16px padding */
      .btn, button, input[type="submit"] {
        padding: 8px 16px !important;
        border-radius: 0.5rem !important;
        font-weight: 500 !important;
        font-size: 14px !important;
        line-height: 1.5 !important;
      }

      /* Smaller icon buttons */
      button i.fa, .btn i.fa {
        font-size: 14px !important;
      }
      
      /* Standard white buttons with black text */
      .btn, .btn-primary, .btn-default, button[type="submit"], input[type="submit"], a.btn {
        background-color: #ffffff !important;
        color: #000000 !important;
        border: 1px solid #e5e5e5 !important;
        padding: 8px 16px !important;
        border-radius: 8px !important;
        font-weight: 500 !important;
        text-decoration: none !important;
        display: inline-block !important;
        transition: all 0.2s ease !important;
      }
      
      .btn:hover, .btn-primary:hover, .btn-default:hover, button[type="submit"]:hover, input[type="submit"]:hover, a.btn:hover {
        background-color: #e5e5e5 !important;
        color: #000000 !important;
        border-color: #d4d4d4 !important;
      }
      
      /* Secondary outline buttons */
      .btn-secondary {
        background-color: transparent !important;
        color: #ffffff !important;
        border: 1px solid #3f3f46 !important;
      }
      
      .btn-secondary:hover {
        background-color: #27272a !important;
        border-color: #52525b !important;
      }
      
      /* Dark mode toggle */
      .dark-mode-toggle {
        background: transparent !important;
        border: 1px solid #1a1a1a !important;
        color: #ffffff !important;
        padding: 8px 12px !important;
        border-radius: 8px !important;
        cursor: pointer !important;
        transition: all 0.2s ease !important;
      }
      
      .dark-mode-toggle:hover {
        background-color: #1a1a1a !important;
        border-color: #333333 !important;
      }
      
      /* Overlay for mobile menu */
      .sidebar-overlay {
        display: none !important;
        position: fixed !important;
        top: 64px !important;
        left: 0 !important;
        right: 0 !important;
        bottom: 0 !important;
        background-color: rgba(0, 0, 0, 0.5) !important;
        z-index: 999 !important;
      }
      
      @media (max-width: 768px) {
        body.sidebar-open .sidebar-overlay {
          display: block !important;
        }
      }

      /* Global smooth transitions - prevent flickering */
      * {
        -webkit-font-smoothing: antialiased !important;
        -moz-osx-font-smoothing: grayscale !important;
      }

      /* Hardware acceleration for smooth animations */
      .dropdown-menu,
      #sidebar,
      .sidebar-toggle,
      .user-menu-trigger,
      #sidebar #side-menu > li > a {
        will-change: transform, opacity !important;
        transform: translateZ(0) !important;
        backface-visibility: hidden !important;
      }

      /* Prevent tap highlight and flickering */
      a, button, .btn, .dropdown-menu li a {
        -webkit-tap-highlight-color: transparent !important;
        outline: none !important;
      }

      /* Smooth transitions for all interactive elements */
      a:not(.no-transition),
      button:not(.no-transition),
      .btn:not(.no-transition) {
        transition: background-color 0.15s ease, color 0.15s ease, border-color 0.15s ease !important;
      }

      /* Tailwind CSS Enhancements */

      /* Remove list bullets globally */
      ul, ol {
        list-style: none !important;
        padding-left: 0 !important;
      }

      /* Credits Display - Match user dropdown styling */
      .credits-display a {
        display: flex !important;
        align-items: center !important;
        gap: 8px !important;
        padding: 6px 12px !important;
        background: transparent !important;
        border: 1px solid #1a1a1a !important;
        border-radius: 10px !important;
        transition: all 0.2s ease !important;
        text-decoration: none !important;
        color: #ffffff !important;
      }

      .credits-display a:hover {
        background-color: #1a1a1a !important;
        border-color: #333333 !important;
      }

      .credits-display i {
        font-size: 18px !important;
        color: #22c55e !important;
      }

      /* Page Content Area - Adjust for sidebar */
      #page-wrapper {
        margin-left: 72px !important;
        transition: margin-left 0.2s ease !important;
        min-height: 100vh !important;
      }

      /* Adjust when sidebar is pinned */
      body.sidebar-pinned #page-wrapper {
        margin-left: 240px !important;
      }

      /* Page Title & Breadcrumb Layout - Left: breadcrumb/title stacked, Right: actions */
      .page-title-breadcrumb {
        margin-top: -40px !important;
        padding: 0px 24px 16px 24px !important;
        background-color: #000000 !important;
        border-bottom: 1px solid #1a1a1a !important;
        display: flex !important;
        flex-direction: row !important;
        justify-content: space-between !important;
        align-items: center !important;
        gap: 24px !important;
      }
      
      /* Left side: breadcrumb and title stacked */
      .page-title-left {
        display: flex !important;
        flex-direction: column !important;
        gap: 8px !important;
      }
      
      /* Right side: action buttons */
      .page-actions {
        margin-left: auto !important;
        display: flex !important;
        gap: 12px !important;
        align-items: center !important;
      }

      .page-header {
        float: none !important;
        width: auto !important;
        margin: 0 !important;
      }

      .page-title {
        font-size: 28px !important;
        font-weight: 700 !important;
        color: #ffffff !important;
        margin: 0 !important;
        padding: 0 !important;
      }

      .page-breadcrumb {
        float: none !important;
        width: auto !important;
        background: transparent !important;
        padding: 0 !important;
        margin: 0 !important;
        display: flex !important;
        align-items: center !important;
        gap: 8px !important;
      }

      .page-breadcrumb li {
        display: flex !important;
        align-items: center !important;
        gap: 8px !important;
        font-size: 14px !important;
        color: #a1a1a1 !important;
      }

      .page-breadcrumb li.active {
        color: #ffffff !important;
      }

      .page-breadcrumb li a {
        color: #a1a1a1 !important;
        text-decoration: none !important;
        transition: color 0.2s ease !important;
      }

      .page-breadcrumb li a:hover {
        color: #ffffff !important;
      }

      .page-breadcrumb li i {
        font-size: 12px !important;
        color: #525252 !important;
      }

      /* Page content padding - minimal */
      .page-content {
        padding: 16px 24px !important;
      }

      /* Responsive breadcrumb - stack better on mobile */
      @media (max-width: 768px) {
        #page-wrapper {
          margin-left: 0 !important;
        }

        body.sidebar-pinned #page-wrapper {
          margin-left: 0 !important;
        }

        .page-title-breadcrumb {
          padding: 16px 16px 12px 16px !important;
        }

        .page-title {
          font-size: 22px !important;
        }

        .page-breadcrumb {
          font-size: 12px !important;
        }

        .page-content {
          padding: 16px !important;
        }
      }
      
      /* Full width tables */
      table, .table {
        width: 100% !important;
      }
    </style>

    <%= csrf_meta_tags %>
    <%= javascript_importmap_tags %>
</head>
<body class="h-full bg-black text-white" data-controller="darkmode sidebar">
    <div class="min-h-screen">
        <!--BEGIN BACK TO TOP-->
        <a id="totop" href="#"><i class="fa fa-angle-up"></i></a>
        <!--END BACK TO TOP-->
        <!--BEGIN TOPBAR-->
        <div id="header-topbar-option-demo" class="page-header-topbar">
            <nav id="topbar" role="navigation" style="margin-bottom: 0;" data-step="3" class="navbar navbar-default navbar-static-top">
            <div class="navbar-header">

               <button
                    type="button"
                    data-action="click->sidebar#toggleMobile"
                    class="sidebar-toggle"
                >
                    <i class="fa fa-bars"></i>
                </button>

                <!-- Organization Dropdown -->
                <div class="organization-dropdown" style="position: relative;">
                    <button 
                        type="button"
                        class="org-dropdown-trigger"
                        data-dropdown-id="orgDropdown"
                        style="display: flex; align-items: center; gap: 10px; padding: 8px 12px; background: transparent; border: 1px solid #1a1a1a; border-radius: 8px; color: white; cursor: pointer; transition: all 0.2s;"
                        onmouseenter="this.style.background='#1a1a1a'; this.style.borderColor='#3f3f46';"
                        onmouseleave="this.style.background='transparent'; this.style.borderColor='#1a1a1a';"
                    >
                        <div style="display: flex; align-items: center; justify-content: center; width: 32px; height: 32px; background: linear-gradient(135deg, <%= current_user.current_org.brand_primary_color %>, <%= current_user.current_org.brand_secondary_color %>); border-radius: 6px; font-weight: 600; font-size: 14px; overflow: hidden;">
                            <% if current_user.current_org.logo.attached? %>
                                <%= image_tag current_user.current_org.logo, style: "width: 100%; height: 100%; object-fit: cover;" %>
                            <% else %>
                                <%= current_user.current_org.initials %>
                            <% end %>
                        </div>
                        <div style="display: flex; flex-direction: column; align-items: flex-start; text-align: left;">
                            <span style="font-size: 14px; font-weight: 600; line-height: 1.2;"><%= current_user.current_org.name.truncate(25) %></span>
                            <span style="font-size: 11px; color: #71717a; line-height: 1.2;"><%= current_user.current_org.plan_features[:name] %></span>
                        </div>
                        <i class="fa fa-chevron-down" style="font-size: 12px; color: #71717a; margin-left: 4px;"></i>
                    </button>

                    <!-- Dropdown Menu -->
                    <div 
                        id="orgDropdown" 
                        class="org-dropdown-menu" 
                        style="display: none; position: absolute; top: calc(100% + 8px); left: 0; min-width: 280px; background: #18181b; border: 1px solid #27272a; border-radius: 12px; box-shadow: 0 10px 40px rgba(0,0,0,0.5); z-index: 9999; overflow: hidden;"
                    >
                        <!-- Current Organization Section -->
                        <div style="padding: 12px 16px; border-bottom: 1px solid #27272a;">
                            <div style="font-size: 11px; color: #71717a; text-transform: uppercase; letter-spacing: 0.5px; margin-bottom: 8px;">Current Organization</div>
                            <div style="display: flex; align-items: center; gap: 10px;">
                                <div style="display: flex; align-items: center; justify-content: center; width: 36px; height: 36px; background: linear-gradient(135deg, <%= current_user.current_org.brand_primary_color %>, <%= current_user.current_org.brand_secondary_color %>); border-radius: 8px; font-weight: 600; font-size: 14px; overflow: hidden;">
                                    <% if current_user.current_org.logo.attached? %>
                                        <%= image_tag current_user.current_org.logo, style: "width: 100%; height: 100%; object-fit: cover;" %>
                                    <% else %>
                                        <%= current_user.current_org.initials %>
                                    <% end %>
                                </div>
                                <div style="flex: 1;">
                                    <div style="font-size: 14px; font-weight: 600; line-height: 1.2;"><%= current_user.current_org.name %></div>
                                    <div style="font-size: 12px; color: #71717a; line-height: 1.2;"><%= current_user.current_org.plan_features[:name] %> Plan</div>
                                </div>
                                <i class="fa fa-check" style="color: #22c55e; font-size: 16px;"></i>
                            </div>
                        </div>

                        <!-- Other Organizations -->
                        <% if current_user.organizations.count > 1 %>
                            <div style="padding: 8px 0; border-bottom: 1px solid #27272a;">
                                <div style="padding: 8px 16px; font-size: 11px; color: #71717a; text-transform: uppercase; letter-spacing: 0.5px;">Switch Organization</div>
                                <% current_user.organizations.where.not(id: current_user.current_org.id).each do |org| %>
                                    <%= form_with url: switch_organization_path(org), method: :post, local: true, style: "margin: 0;" do %>
                                        <button 
                                            type="submit"
                                            style="width: 100%; display: flex; align-items: center; gap: 10px; padding: 10px 16px; background: transparent; border: none; color: white; cursor: pointer; transition: background 0.2s;"
                                            onmouseenter="this.style.background='#27272a';"
                                            onmouseleave="this.style.background='transparent';"
                                        >
                                            <div style="display: flex; align-items: center; justify-content: center; width: 32px; height: 32px; background: linear-gradient(135deg, <%= org.brand_primary_color %>, <%= org.brand_secondary_color %>); border-radius: 6px; font-weight: 600; font-size: 12px; overflow: hidden;">
                                                <% if org.logo.attached? %>
                                                    <%= image_tag org.logo, style: "width: 100%; height: 100%; object-fit: cover;" %>
                                                <% else %>
                                                    <%= org.initials %>
                                                <% end %>
                                            </div>
                                            <div style="flex: 1; text-align: left;">
                                                <div style="font-size: 13px; font-weight: 500; line-height: 1.2;"><%= org.name %></div>
                                                <div style="font-size: 11px; color: #71717a; line-height: 1.2;"><%= org.plan_features[:name] %> Plan</div>
                                            </div>
                                        </button>
                                    <% end %>
                                <% end %>
                            </div>
                        <% end %>

                        <!-- Organization Settings -->
                        <div style="padding: 8px;">
                            <a 
                                href="/organization"
                                style="width: 100%; display: flex; align-items: center; gap: 10px; padding: 10px 12px; background: transparent; border-radius: 6px; color: white; text-decoration: none; transition: background 0.2s;"
                                onmouseenter="this.style.background='#27272a';"
                                onmouseleave="this.style.background='transparent';"
                            >
                                <i class="fa fa-cog" style="width: 16px; color: #71717a;"></i>
                                <span style="font-size: 13px;">Organization Settings</span>
                            </a>
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- Command+K Search Bar -->
            <div class="header-search">
                <button 
                    id="searchTrigger"
                    type="button"
                    style="width: 100%; display: flex; align-items: center; gap: 12px; padding: 8px 16px; background: transparent; border: 1px solid #1a1a1a; border-radius: 10px; color: #71717a; cursor: pointer; transition: all 0.2s;"
                    onmouseenter="this.style.background='#1a1a1a'; this.style.borderColor='#333333';"
                    onmouseleave="this.style.background='transparent'; this.style.borderColor='#1a1a1a';"
                    onclick="document.getElementById('commandSearchBar').style.display='block'; document.getElementById('commandSearchInput').focus();"
                >
                    <i class="fa fa-search" style="color: #71717a; font-size: 14px;"></i>
                    <span style="flex: 1; text-align: left; font-size: 14px;">Search...</span>
                    <div style="display: flex; align-items: center; gap: 4px; padding: 2px 8px; background: #1a1a1a; border-radius: 6px; font-size: 12px; font-family: monospace;">
                        <span>⌘</span><span>K</span>
                    </div>
                </button>
            </div>
            
            <div class="topbar-main">
                <ul class="nav navbar navbar-top-links navbar-right mbn">
                    <!-- Wallet Balance -->
                    <li class="credits-display" style="margin-right: 15px;">
                        <a href="/credits">
                            <i class="fa-solid fa-wallet"></i>
                            <div style="display: flex; flex-direction: column; gap: 2px;">
                                <span style="font-size: 14px; font-weight: 600; color: #22c55e; line-height: 1;">$<%= '%.2f' % current_user.credits_balance %></span>
                                <span style="font-size: 12px; color: #71717a; line-height: 1;">Wallet</span>
                            </div>
                        </a>
                    </li>

                    <li class="dropdown topbar-user">
                        <a data-hover="dropdown" data-toggle="dropdown" href="#" class="dropdown-toggle user-menu-trigger">
                            <div class="user-avatar">
                                <%= current_user.name.split(' ').map(&:first).join.upcase %>
                            </div>
                            <div class="user-info">
                                <span class="user-name"><%=current_user.name%></span>
                                <span class="user-org">Personal Account</span>
                            </div>
                            <i class="fa fa-chevron-down"></i>
                        </a>
                        <ul class="dropdown-menu dropdown-user pull-right">
                            <li class="dropdown-header">
                                <div class="user-header-info">
                                    <div class="user-header-avatar">
                                        <%= current_user.name.split(' ').map(&:first).join.upcase %>
                                    </div>
                                    <div class="user-header-details">
                                        <div class="user-header-name"><%=current_user.name%></div>
                                        <div class="user-header-email"><%=current_user.email%></div>
                                    </div>
                                </div>
                            </li>
                            <li class="divider"></li>
                            <li class="dropdown-section-title">Account</li>
                            <li><a href="/myaccount"><i class="fa-regular fa-user"></i>Account Overview</a></li>
                            <li><a href="/subscriptions"><i class="fa-regular fa-credit-card"></i>Billing & Plans</a></li>
                            <li><a href="/invoices"><i class="fa-regular fa-file-lines"></i>Invoices</a></li>
                            <li><a href="/credits"><i class="fa-solid fa-wallet"></i>Wallet</a></li>
                            <li class="divider"></li>
                            <li><a href="/logout"><i class="fa fa-sign-out"></i>Log Out</a></li>
                        </ul>
                    </li>
                </ul>
            </div>
            </nav>
        </div>
        <!--END TOPBAR-->
        <div id="wrapper">
            <!--BEGIN SIDEBAR MENU-->
            <nav id="sidebar" role="navigation" data-controller="sidebar" data-step="2" data-intro="Template has &lt;b&gt;many navigation styles&lt;/b&gt;"
                data-position="right" class="navbar-default navbar-static-side">
                <button type="button" class="sidebar-pin" data-action="click->sidebar#togglePin" title="Pin sidebar">
                    <i class="fa-solid fa-thumbtack"></i>
                </button>
            <div class="sidebar-collapse menu-scroll" style="overflow:initial">
                <ul id="side-menu" class="nav ">                    
                     <div class="clearfix"></div>
                    <li><a href="/dashboards"><i class="fa-solid fa-gauge fa-fw"></i><span class="menu-title">Dashboard</span></a>
                    </li>
                    <li><a href="/campaigns"><i class="fa-solid fa-bullhorn fa-fw"></i><span class="menu-title">Campaigns</span></a>
                    </li>
                    <%# Banners temporarily hidden - focus on video for now
                    <li><a href="/banners"><i class="fa-regular fa-image fa-fw"></i><span class="menu-title">Banners</span></a>
                    </li>
                    %>
                    <li><a href="/banner_videos"><i class="fa-solid fa-video fa-fw"></i><span class="menu-title">Videos</span></a>
                    </li>
                    <li><a href="/targets"><i class="fa-solid fa-users fa-fw"></i><span class="menu-title">Audiences</span></a>
                    </li>
                    <li><a href="/rtb_standards"><i class="fa-solid fa-sliders fa-fw"></i><span class="menu-title">Rules</span></a>
                    </li>
                    <li><a href="/lists"><i class="fa-solid fa-list fa-fw"></i><span class="menu-title">Lists</span></a>
                    </li>
                    
                     <li><a href="/organization"><i class="fa-solid fa-building fa-fw"></i><span class="menu-title">Organization</span></a>
                    </li>
                        
                     <li><a href="/help"><i class="fa-solid fa-circle-question fa-fw"></i><span class="menu-title">Documentation</span></a>
                    </li>

                    <%# Hidden from sidebar - accessible via dropdown menu
                     <li><a href="/myaccount"><i class="fa-regular fa-user fa-fw"></i><span class="menu-title">Account</span></a>
                    </li>

                     <li><a href="/credits"><i class="fa-solid fa-wallet fa-fw"></i><span class="menu-title">Wallet</span></a>
                    </li>

                     <li><a href="/subscriptions"><i class="fa-regular fa-credit-card fa-fw"></i><span class="menu-title">Billing & Plans</span></a>
                    </li>

                     <li><a href="/invoices"><i class="fa-regular fa-file-lines fa-fw"></i><span class="menu-title">Invoices</span></a>
                    </li>
                    %>

                    <% if current_user.admin %>
                     <li><a href="/users"><i class="fa-solid fa-user-gear fa-fw"></i><span class="menu-title">Admin Users</span></a>
                    </li>
                      <li><a href="/admin/credits"><i class="fa-solid fa-wallet fa-fw"></i><span class="menu-title">Admin Wallet</span></a>
                     </li>
                     <li><a href="/categories"><i class="fa-solid fa-folder-tree fa-fw"></i><span class="menu-title">Admin Categories</span></a>
                    </li>
                     <li><a href="/documents"><i class="fa-solid fa-file-lines fa-fw"></i><span class="menu-title">Admin Documents</span></a>
                    </li>
                    <%end%>

                    
                </ul>
            </div>
            </nav>
            <!--END SIDEBAR MENU-->
            <!--BEGIN PAGE WRAPPER-->
            <div id="page-wrapper">
               <!--BEGIN TITLE & BREADCRUMB PAGE-->
                <div id="title-breadcrumb-option-demo" class="page-title-breadcrumb"> 
                    <%= yield(:breadcrumb) if content_for?(:breadcrumb) %>	
                    <div class="clearfix"></div>
                </div>
                <!--END TITLE & BREADCRUMB PAGE-->
                <!--BEGIN CONTENT-->
                <div class="page-content">
                    <p id="notice"><%= sanitize(notice, tags: %w(strong em br), attributes: []) if notice.present? %></p>
                    
                    <%= yield(:main_body) if content_for?(:main_body) %>	
                </div>
                <!--END CONTENT-->
            </div>
            <!--END PAGE WRAPPER-->
        </div>
    </div>
     <%# Modern TypeScript bundle loaded in <head> - no legacy vendor_libs needed %>
     <%= yield(:javascript) if content_for?(:javascript) %>

    <!-- Command+K Search Modal -->
    <div id="commandSearchBar" class="command-search-modal" style="display: none;">
        <div style="max-width: 640px; width: 100%;">
            <div style="background: #18181b; border: 1px solid #27272a; border-radius: 16px; box-shadow: 0 20px 60px rgba(0,0,0,0.5); overflow: hidden;">
                <!-- Search Input -->
                <div style="padding: 16px 20px; border-bottom: 1px solid #27272a; display: flex; align-items: center; gap: 12px;">
                    <i class="fa fa-search" style="color: #71717a; font-size: 16px;"></i>
                    <input 
                        id="commandSearchInput"
                        type="text"
                        placeholder="Search campaigns, banners, videos, audiences..."
                        style="flex: 1; background: transparent; border: none; outline: none; color: #ffffff; font-size: 16px; padding: 4px 0;"
                        autofocus
                    />
                    <div style="display: flex; align-items: center; gap: 4px; padding: 4px 10px; background: #27272a; border-radius: 6px; font-size: 12px; color: #71717a; font-family: monospace;">
                        <span>ESC</span>
                    </div>
                </div>
                
                <!-- Search Results -->
                <div id="searchResults" style="max-height: 400px; overflow-y: auto;">
                    <!-- Quick Links -->
                    <div style="padding: 12px 20px;">
                        <div style="font-size: 11px; color: #71717a; text-transform: uppercase; letter-spacing: 0.5px; margin-bottom: 8px;">Quick Actions</div>
                        <a href="/campaigns/new" style="display: flex; align-items: center; gap: 12px; padding: 10px 12px; background: transparent; border-radius: 8px; color: #ffffff; text-decoration: none; transition: background 0.2s;" onmouseenter="this.style.background='#27272a';" onmouseleave="this.style.background='transparent';">
                            <i class="fa-solid fa-plus" style="color: #3b82f6; width: 20px;"></i>
                            <span>New Campaign</span>
                        </a>
                        <a href="/banner_videos/new" style="display: flex; align-items: center; gap: 12px; padding: 10px 12px; background: transparent; border-radius: 8px; color: #ffffff; text-decoration: none; transition: background 0.2s;" onmouseenter="this.style.background='#27272a';" onmouseleave="this.style.background='transparent';">
                            <i class="fa-solid fa-video" style="color: #8b5cf6; width: 20px;"></i>
                            <span>New Video</span>
                        </a>
                        <a href="/targets/new" style="display: flex; align-items: center; gap: 12px; padding: 10px 12px; background: transparent; border-radius: 8px; color: #ffffff; text-decoration: none; transition: background 0.2s;" onmouseenter="this.style.background='#27272a';" onmouseleave="this.style.background='transparent';">
                            <i class="fa-solid fa-users" style="color: #22c55e; width: 20px;"></i>
                            <span>New Audience</span>
                        </a>
                    </div>
                    
                    <!-- Navigation -->
                    <div style="padding: 12px 20px; border-top: 1px solid #27272a;">
                        <div style="font-size: 11px; color: #71717a; text-transform: uppercase; letter-spacing: 0.5px; margin-bottom: 8px;">Navigate</div>
                        <a href="/dashboards" style="display: flex; align-items: center; gap: 12px; padding: 10px 12px; background: transparent; border-radius: 8px; color: #ffffff; text-decoration: none; transition: background 0.2s;" onmouseenter="this.style.background='#27272a';" onmouseleave="this.style.background='transparent';">
                            <i class="fa-solid fa-gauge" style="color: #71717a; width: 20px;"></i>
                            <span>Dashboard</span>
                        </a>
                        <a href="/campaigns" style="display: flex; align-items: center; gap: 12px; padding: 10px 12px; background: transparent; border-radius: 8px; color: #ffffff; text-decoration: none; transition: background 0.2s;" onmouseenter="this.style.background='#27272a';" onmouseleave="this.style.background='transparent';">
                            <i class="fa-solid fa-bullhorn" style="color: #71717a; width: 20px;"></i>
                            <span>Campaigns</span>
                        </a>
                        <a href="/banner_videos" style="display: flex; align-items: center; gap: 12px; padding: 10px 12px; background: transparent; border-radius: 8px; color: #ffffff; text-decoration: none; transition: background 0.2s;" onmouseenter="this.style.background='#27272a';" onmouseleave="this.style.background='transparent';">
                            <i class="fa-solid fa-video" style="color: #71717a; width: 20px;"></i>
                            <span>Videos</span>
                        </a>
                        <a href="/organization" style="display: flex; align-items: center; gap: 12px; padding: 10px 12px; background: transparent; border-radius: 8px; color: #ffffff; text-decoration: none; transition: background 0.2s;" onmouseenter="this.style.background='#27272a';" onmouseleave="this.style.background='transparent';">
                            <i class="fa-solid fa-building" style="color: #71717a; width: 20px;"></i>
                            <span>Organization Settings</span>
                        </a>
                    </div>
                </div>
            </div>
            
            <!-- Keyboard Shortcuts Help -->
            <div style="margin-top: 12px; text-align: center; font-size: 12px; color: #71717a;">
                <span style="padding: 2px 8px; background: #18181b; border-radius: 6px; margin: 0 4px;">↑↓</span> to navigate
                <span style="padding: 2px 8px; background: #18181b; border-radius: 6px; margin: 0 4px;">↵</span> to select
                <span style="padding: 2px 8px; background: #18181b; border-radius: 6px; margin: 0 4px;">ESC</span> to close
            </div>
        </div>
    </div>

    <script>
        // Generalized Dropdown Handler (works for org dropdown and user dropdown)
        document.addEventListener('DOMContentLoaded', function() {
            // Initialize all dropdowns
            initializeDropdown('.org-dropdown-trigger', '#orgDropdown');
            initializeDropdown('.user-menu-trigger', '.dropdown-user');
            
            function initializeDropdown(triggerSelector, dropdownSelector) {
                const trigger = document.querySelector(triggerSelector);
                const dropdown = document.querySelector(dropdownSelector);
                
                if (!trigger || !dropdown) return;
                
                let hideTimeout = null;
                
                // Show dropdown on hover
                trigger.addEventListener('mouseenter', function() {
                    clearTimeout(hideTimeout);
                    dropdown.style.display = 'block';
                    dropdown.style.opacity = '1';
                });
                
                // Keep dropdown open when hovering over it
                dropdown.addEventListener('mouseenter', function() {
                    clearTimeout(hideTimeout);
                    dropdown.style.display = 'block';
                    dropdown.style.opacity = '1';
                });
                
                // Hide dropdown with delay when leaving trigger
                trigger.addEventListener('mouseleave', function() {
                    hideTimeout = setTimeout(function() {
                        dropdown.style.display = 'none';
                        dropdown.style.opacity = '0';
                    }, 300);
                });
                
                // Hide dropdown with delay when leaving dropdown
                dropdown.addEventListener('mouseleave', function() {
                    hideTimeout = setTimeout(function() {
                        dropdown.style.display = 'none';
                        dropdown.style.opacity = '0';
                    }, 300);
                });
                
                // Toggle on click (for mobile/accessibility)
                trigger.addEventListener('click', function(e) {
                    e.preventDefault();
                    e.stopPropagation();
                    const isVisible = dropdown.style.display === 'block';
                    dropdown.style.display = isVisible ? 'none' : 'block';
                    dropdown.style.opacity = isVisible ? '0' : '1';
                });
                
                // Close dropdown when clicking outside
                document.addEventListener('click', function(e) {
                    if (!trigger.contains(e.target) && !dropdown.contains(e.target)) {
                        dropdown.style.display = 'none';
                        dropdown.style.opacity = '0';
                    }
                });
                
                // Prevent dropdown from closing when clicking inside
                dropdown.addEventListener('click', function(e) {
                    e.stopPropagation();
                });
            }
            
            // Command+K Search Bar Toggle
            const searchBar = document.getElementById('commandSearchBar');
            const searchInput = document.getElementById('commandSearchInput');
            
            if (searchBar && searchInput) {
                // Show search on Cmd+K / Ctrl+K
                document.addEventListener('keydown', function(e) {
                    if ((e.metaKey || e.ctrlKey) && e.key === 'k') {
                        e.preventDefault();
                        searchBar.style.display = 'block';
                        searchInput.focus();
                    }
                    
                    // Close on Escape
                    if (e.key === 'Escape') {
                        searchBar.style.display = 'none';
                        searchInput.value = '';
                    }
                });
                
                // Close search when clicking outside
                searchBar.addEventListener('click', function(e) {
                    if (e.target === searchBar) {
                        searchBar.style.display = 'none';
                        searchInput.value = '';
                    }
                });
                
                // Handle search input
                searchInput.addEventListener('input', function(e) {
                    const query = e.target.value.toLowerCase();
                    // TODO: Implement search functionality
                    console.log('Search query:', query);
                });
            }
        });
    </script>

</body>
</html>
